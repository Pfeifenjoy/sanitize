kind: pipeline
name: default

steps:

- name: install
  image: node
  environment:
    NPM_TOKEN:
      from_secret: npm_token
  commands:
  - npm install

- name: test
  image: node
  environment:
    NPM_TOKEN:
      from_secret: npm_token
  commands:
  - npm test

- name: build
  image: node
  environment:
    NPM_TOKEN:
      from_secret: npm_token
  commands:
  - npm run build

- name: publish
  image: node
  environment:
    NPM_TOKEN:
      from_secret: npm_token
  commands:
    - ls -lisah
    - npm whoami
    - npm publish
  when:
    branch:
    - master
    event:
      exclude:
      - pull_request
